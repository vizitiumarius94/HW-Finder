<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Add Car to JSON (Preserve Order)</title>
<style>
  body { font-family: sans-serif; padding: 20px; }
  input, button { display: block; margin: 10px 0; padding: 5px; width: 300px; }
  label { font-weight: bold; margin-top: 15px; }
  textarea { width: 600px; height: 400px; margin-top: 20px; }
</style>
</head>
<body>

<h1>Import JSON & Add Car (Order Preserved)</h1>

<label for="importFile">Import JSON File</label>
<input type="file" id="importFile">

<h2>Add New Car</h2>

<label for="year">Year</label>
<input type="number" id="year" placeholder="2025">

<label for="caseLetter">Case Letter</label>
<input type="text" id="caseLetter" placeholder="A">

<label for="carName">Car Name</label>
<input type="text" id="carName">

<label for="carImage">Car Image Path</label>
<input type="text" id="carImage" placeholder="images\\HW1234th.jpg">

<label for="hwNumber">HW Number</label>
<input type="text" id="hwNumber">

<label for="color">Color</label>
<input type="text" id="color">

<label for="series">Series</label>
<input type="text" id="series">

<label for="seriesNumber">Series Number</label>
<input type="text" id="seriesNumber">

<button id="addCarBtn">Add Car</button>
<button id="exportBtn">Export Updated JSON</button>

<h2>Updated JSON Preview</h2>
<textarea id="dataOutput" readonly></textarea>

<script>
let carsDataArray = []; // Array of { year: "2025", cases: [...] }

const importFile = document.getElementById('importFile');
const yearInput = document.getElementById('year');
const caseInput = document.getElementById('caseLetter');
const nameInput = document.getElementById('carName');
const imageInput = document.getElementById('carImage');
const hwNumberInput = document.getElementById('hwNumber');
const colorInput = document.getElementById('color');
const seriesInput = document.getElementById('series');
const seriesNumberInput = document.getElementById('seriesNumber');
const dataOutput = document.getElementById('dataOutput');

// Load JSON file
importFile.addEventListener('change', e => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = evt => {
    try {
      const imported = JSON.parse(evt.target.result);

      // Convert object with years as keys into ordered array
      carsDataArray = Object.keys(imported).map(year => ({
        year: year,
        cases: imported[year].cases || []
      }));

      updateOutput();
      alert('JSON imported successfully!');
    } catch(err) {
      alert('Failed to parse JSON: ' + err.message);
    }
  };
  reader.readAsText(file);
});

// Update live JSON preview
function updateOutput() {
  // Convert array back to object for compatibility if needed
  const obj = {};
  carsDataArray.forEach(entry => {
    obj[entry.year] = { cases: entry.cases };
  });
  dataOutput.value = JSON.stringify(obj, null, 2);
}

// Add new car
document.getElementById('addCarBtn').addEventListener('click', () => {
  const year = yearInput.value.trim();
  const caseLetter = caseInput.value.trim().toUpperCase();
  const car = {
    name: nameInput.value.trim(),
    image: imageInput.value.trim(),
    hw_number: hwNumberInput.value.trim(),
    color: colorInput.value.trim(),
    series: seriesInput.value.trim(),
    series_number: seriesNumberInput.value.trim()
  };

  if (!year || !caseLetter || !car.name || !car.image || !car.hw_number) {
    return alert('Please fill in all required fields.');
  }

  // Find or create year
  let yearEntry = carsDataArray.find(y => y.year === year);
  if (!yearEntry) {
    yearEntry = { year: year, cases: [] };
    carsDataArray.push(yearEntry); // Append at end to preserve order
  }

  // Find or create case
  let hwCase = yearEntry.cases.find(c => c.letter === caseLetter);
  if (!hwCase) {
    hwCase = { letter: caseLetter, cars: [] };
    yearEntry.cases.push(hwCase); // Append at end
  }

  // Add the car
  hwCase.cars.push(car);

  updateOutput();

  // Clear inputs
  nameInput.value = '';
  imageInput.value = '';
  hwNumberInput.value = '';
  colorInput.value = '';
  seriesInput.value = '';
  seriesNumberInput.value = '';

  alert('Car added successfully!');
});

// Export updated JSON
document.getElementById('exportBtn').addEventListener('click', () => {
  const obj = {};
  carsDataArray.forEach(entry => {
    obj[entry.year] = { cases: entry.cases };
  });

  const blob = new Blob([JSON.stringify(obj, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'updated_data.json';
  a.click();
  URL.revokeObjectURL(url);
});
</script>

</body>
</html>